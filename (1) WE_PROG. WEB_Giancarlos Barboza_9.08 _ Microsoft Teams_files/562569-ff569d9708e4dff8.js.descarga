"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[562569],{241369:(e,t,n)=>{var a;n.d(t,{k:()=>a,w:()=>l}),function(e){e.Configurations="Configurations",e.HorizontalBar="HorizontalBar",e.Main="Main",e.Modal="Modal",e.Monitor="Monitor",e.Rail="Rail",e.OverlayThinHorizontalBar="OverlayThinHorizontalBar",e.PartialOverlay="PartialOverlay",e.ThinHorizontalBar="ThinHorizontalBar",e.TitleBar="TitleBar",e.VerticalBar="VerticalBar",e.PreCache="PreCache"}(a||(a={}));const{OverlayThinHorizontalBar:i,ThinHorizontalBar:r,TitleBar:o,VerticalBar:s,...l}=a},55265:(e,t,n)=>{var a;n.d(t,{Y:()=>a}),function(e){e[e.chat=0]="chat",e[e.channel=1]="channel",e[e.tab=2]="tab",e[e.powerbar=3]="powerbar"}(a||(a={}))},466563:(e,t,n)=>{n.d(t,{Xp:()=>o,AX:()=>s,q0:()=>l,WD:()=>c,Tp:()=>d});var a=n(942016),i=n(313065),r=n(804510);function o(e,t){return{entity:{type:a.ck.chats,action:a.SY.create,id:s(e)},command:t}}function s(e){return JSON.stringify(e&&e.length>0?e.sort():[])}function l(e,t,n,a){let i={};if(!e)return i;if(e.type===t&&e.action===n){const t=e.options;if(t&&"string"==typeof t)try{i=JSON.parse(t)}catch{a.warn(`Entity options are in unexpected format. Expected a valid stringified JSON object but instead received: ${String(t)}.`)}}else a.warn(`Entity options are (incorrectly) being asked for type and action that do not pertain to the entity. ${String(e.type)} != ${String(t)} or ${String(e.action)} != ${String(n)}`);return i}const c=e=>`${e.substring(0,32)}00000000${e.substring(40)}`,d=(e,t,n,a,o)=>{let s=`${i.Hr}-${n}`;if(a){const t=e.getApp({entityType:a})?.manifest.id;s=t?`${i.Hr}-${t}-${a}`:s}const l=t.get((0,i.up)(s,o),"Experience"),c=l?(0,r.j)(l):null;return c?.mainEntity}},403376:(e,t,n)=>{n.d(t,{r:()=>i});var a=n(362328);const i={kind:"Document",get definitions(){const e=(0,a.G)("query messageToParentResult($appId:ID!) {messageToParentResult(appId:$appId) @client {appId,message}}");return delete this.definitions,this.definitions=e.definitions}}},312836:(e,t,n)=>{n.d(t,{hi:()=>l,n7:()=>s,ZN:()=>c,Hs:()=>d});var a=n(757060),i=n(362328);const r={kind:"Document",get definitions(){const e=(0,i.G)("query ServicesIoDataEspLockCurrentSurfaceIdQuery {currentEspSurfaceId @client}");return delete this.definitions,this.definitions=e.definitions}},o="growth_growthplatform_esp_common_component",s=async(e,t,n)=>{try{const a=e.readQuery({query:r});if(a&&a?.currentEspSurfaceId)return t.infoToTelemetry?.(`Couldn't show surface (${n}). ${a.currentEspSurfaceId} is showing`,o,void 0,!0),Promise.reject(!1);e.writeQuery({query:r,data:{currentEspSurfaceId:n}})}catch{return t.errorToTelemetry?.(`Couldn't show surface (${n}). Could not update current surface`,o,void 0,!0),Promise.reject(!1)}return Promise.resolve(!0)},l=async(e,t)=>{try{const n=e.readQuery({query:r});n&&n?.currentEspSurfaceId===t&&e.writeQuery({query:r,data:{currentEspSurfaceId:""}})}catch{return Promise.reject(!1)}return Promise.resolve(!0)},c=(e,t)=>{try{e.writeQuery({query:r,data:{currentEspSurfaceId:t}})}catch{throw new Error(`Couldn't change current surface to "${t}".`)}},d=()=>{const{data:e}=(0,a.I)(r);return e?.currentEspSurfaceId??""}},471735:(e,t,n)=>{n.d(t,{nv:()=>r,JT:()=>o,iO:()=>s});var a=n(332752),i=n(848020);const r=e=>e.get(a.w.Auth).buildCloud,o=(e,t)=>{const n=t?.get(a.w.Auth).cloudDomainMap;if(!n)return;const r=n.find((t=>t.domain===e))?.cloud;return r?i.el[r]:void 0},s=(e,t,n)=>{const i=t?.get(a.w.Auth).cloudDomainMap;if(!i||!e)return"";const r=i.find((t=>t.cloud===e))?.domain;return r?n?`https://${r}/`:`https://${r}/v2/`:""}},916042:(e,t,n)=>{n.d(t,{dz:()=>l,cd:()=>c,BD:()=>d,bo:()=>p,iy:()=>u,cF:()=>g,$f:()=>m,Cd:()=>h,sB:()=>f,t5:()=>I,iX:()=>y,lO:()=>w,k5:()=>v});var a=n(170962),i=n(374348),r=n(332752),o=n(223044),s=n(471735);const l=a.d,c=a.t.isLegacyMeetingUrl,d=a.t.isMeetingUrl,p=a.t.isTFLMeetingURL,u=a.t.getMeetingLegacyURL,g=(e,t)=>{const{enableIsTfwCloud:n}=t.get(r.w.Calling);return n?a.t.isTFWCloud((0,s.JT)(e,t)):a.t.isTFWDomain(e)},m=(e,t)=>{if(t){const n=(0,s.JT)(new URL(t).host,e);return!!n&&n!==(0,s.nv)(e)&&!f(t,e)}return!1},h=(e,t,n)=>{try{const i=(0,s.JT)(t,e),r=n?(0,s.JT)(n,e):(0,s.nv)(e),o=a.t.isInteropJoinAttemptBetweenTFLAndTFW(r,i);return!!i&&!!r&&i!==r&&!o}catch{return!1}},f=(e,t)=>{const{deepLinkDomain:n,enableMeetingBetweenTFWAndTFL:i,enableCrossCloudDetectionBasedOnLoggedInUserProps:o}=t.get(r.w.Calling);if(!o)return a.t.isDeepLinkExecutionForCrossCloudMeetingJoinBetweenTFLAndTFWAllowed(n||"",e,!!i);try{const r=new URL(e).hostname,o=(0,s.JT)(r,t),l=new URL(n||"").hostname,c=(0,s.JT)(l||"",t);return a.t.isMeetingUrl(e)&&a.t.isInteropJoinAttemptBetweenTFLAndTFW(c,o)&&!!i}catch(e){return!1}},I=e=>({coordinates:{meetingData:{instantMeetingOptions:void 0,isAdhoc:!0}},joinOptions:{outgoingVideo:!0,outgoingAudio:!0,context:"WatchParty",meeting:{deeplinkId:e,isWatchParty:!0,showPrejoin:!0}},type:"Meeting"}),y=(e,t,n,a,r,o,s,l,c,d,p,u)=>{let g;if((0,i.KX)(e)){const{conversationId:t,messageId:n,rootMessageId:a,isChannel:i,isAdhoc:r,tenantId:o,organizerId:s,meetingCloud:l,registration:c,participantPin:d,broadcast:p}=e;g={legacyMeeting:{conversationId:t,messageId:n,rootMessageId:a,isChannel:i,isAdhoc:r,tenantId:o,organizerId:s,meetingCloud:l,registration:c,broadcast:p,participantPin:d}}}else{const{meetingCode:t,passcode:n,meetingUrl:a}=e.meetingData,{isAdhoc:i,meetingCloud:r}=e;g={meetingData:{participantPin:e?.participantPin,meetingCode:t,passcode:n,meetingUrl:a,isAdhoc:i,meetingCloud:r}}}return{coordinates:g,joinOptions:{outgoingVideo:!1,outgoingAudio:!1,context:o||"DeepLink",meeting:{deeplinkId:t,showPrejoin:!0,isPSTN:!1,homeCloud:a,correlationId:r,launchAgent:s,laEntry:l,laExpId:c,isColdDeeplinkJoin:n,deeplinkEntityId:p,title:u}},scenarioCorrelationId:d,type:"Meeting"}},w=(e,t,n,a,i,r=!0)=>({coordinates:{legacyMeeting:{conversationId:n,messageId:a,rootMessageId:"",isChannel:!1,isAdhoc:!1,tenantId:e,organizerId:t,meetingCloud:"",broadcast:null,registration:i?{participantRegistrationId:i,isPublic:!0}:null,instantMeetingOptions:null}},joinOptions:{outgoingVideo:!1,outgoingAudio:!1,context:"Meeting EmbedLink",meeting:{showPrejoin:r,isPSTN:!1,skipGUM:!0}},type:"Meeting"}),v=e=>{e=e.replace("v2/?meetingjoin=true#/","").replace("v2/#/","");let t;if(d(e))try{const n=(0,o.wM)(e);t=n.isLegacyUrl?n.threadId:n.meetingId}catch{return}return t}},961207:(e,t,n)=>{function a(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}n.d(t,{a:()=>a})},263422:(e,t,n)=>{n.d(t,{j:()=>a});const a=(e,t)=>e?"Conversational":t?"PostReply":"Unthreaded"},313065:(e,t,n)=>{n.d(t,{Hr:()=>a,jE:()=>i,eW:()=>r,E:()=>o,up:()=>s});const a="appActiveEntitiesHistory",i="mainWindowNavHistory",r="mainWindowNavHistoryIndex",o=e=>{const t=["mainWindowNavHistory","mainWindowNavHistoryIndex"];return e&&t.push(`${e}-mainWindowNavHistory`,`${e}-mainWindowNavHistoryIndex`),t},s=(e,t)=>`${t?`${t}-`:""}${e}`},250321:(e,t,n)=>{n.d(t,{RB:()=>o,ip:()=>s,vN:()=>l,SR:()=>c,jK:()=>d,WG:()=>p,Vz:()=>u});var a=n(332752),i=n(579915),r=n(876343);function o(e){if(""===e)return null;const t=(0,r.Yn)("entity",i.l.Help,"training");return(0,r.jT)(e,t)}function s(e,t,n,a,i,o,s){const l=new URLSearchParams({source:n});return a&&l.append("sharedAppResource",a),i&&l.append("templateInstanceId",i),o&&l.append("environment",o),s&&l.append("titleId",s),(0,r.jT)(e,`app/${t}`,l.toString())}function l(e,t,n,a,i,r,o){const s=new URLSearchParams;return!t||i||a||r||o||s.append("appId",t),o&&s.append("titleId",o),a&&s.append("templatedAppId",a),i&&s.append("templateInstanceId",i),r&&s.append("environment",r),n&&s.append("source",n),`${e}?${s.toString()}`}function c(e,t,n,a,i){if(!e||!t||!n)return"";let o;return o=i?new URLSearchParams({templateInstanceId:n,environment:i,source:a}):new URLSearchParams({templateInstanceId:n,source:a}),(0,r.jT)(e,`app/${t}`,o.toString())}function d(e,t,n){return e&&t&&void 0!==n?(0,r.jT)(e,"marketplace",`deviceId=${t}&isTeamsRoomDevice=${n}`):""}function p(e,t){const{harmonyAppUrlRegex:n,enableHarmonyDeeplinkConversion:i}=t.get(a.w.Extensibility);return!(!n||!i)&&new RegExp(n).test(e)}function u(e,t,n){const{harmonyAppUrlRegex:i,enableHarmonyDeeplinkConversion:o,enableViralSharingLinkUnfurlingAndShortening:l}=n.get(a.w.Extensibility);if(!i||!o)return e;let c=e.replace(/&amp;/g,"&");const d=new RegExp(i),p=c.match(d);if(!p)return e;const u=new URLSearchParams(p[1]),g=u.get("templatedAppId")||"",m=u.get("templateInstanceId")||"",h=u.get("environment")||"",f=u.get("appId")||"",I=l&&u.get("titleId")||"",y=u.get("source")||(I?"biz-chat":"");return c=s((0,r.aE)(t),I?"":f||g,y,void 0,m,h,I),c}},763568:(e,t,n)=>{n.d(t,{u8:()=>c,qL:()=>d,VC:()=>h,ai:()=>f});var a=n(332752),i=n(802756),r=n(277362);const o=["msteams:","ms-teams:"],s=36,l=["/l/esp/whats-new-content","/l/esp/teams-insider"];function c(e,t,n=!1){const{deepLinkDomains:i,deepLinkPaths:r,supportHashDeeplinks:o}=t.get(a.w.Messaging),s=n?[""]:r||[];let l=i||[];return n||(l=l.concat(function(e){const{enableCrossCloudLaunch:t}=e.get(a.w.Core);if(!t)return[];const n=e?.get(a.w.Auth).cloudDomainMap;if(!n)return[];const i=n.map((e=>`https://${e.domain}`));return i}(t))),m({url:e,deepLinkDomains:l,deepLinkPaths:s,supportHashDeeplinks:!!o,coreSettings:t})}function d(e,t){if(o.includes(e.protocol)){const n=t.get(a.w.Host).deepLinkDomain||void 0,i=p(e,t)||n;return new URL(`${e.pathname}${e.search}${e.hash}`,i)}return e}const p=(e,t)=>{const{enableOriginValidationForIncomingIntents:n}=t.get(a.w.Core);if(!n||"null"!==e.origin)return e.origin;if(!o.includes(e.protocol))return;const i=e.searchParams.get("fqdn");return i?new URL(`https://${i}`).origin:"null"===e.origin&&e.hostname?new URL(`https://${e.hostname}`).origin:void 0},u=(e,t,n,a)=>{const i=p(e,a);return!(i&&i!==t.origin||!e.pathname.startsWith(n))},g=(e,t,n)=>{const a=p(e,n);return!(a&&a!==t.origin||!e.hash||"/_"!==e.pathname)},m=({url:e,deepLinkDomains:t,deepLinkPaths:n,supportHashDeeplinks:a,coreSettings:i})=>{for(const r of t)for(const t of n){let n,o;try{n=new URL(e),o=new URL(t,r)}catch(e){return!1}if(u(n,o,t,i))return!0;if(a&&g(n,o,i))return!0}return!1};function h(e){return e?.slice(0,s)??null}function f(e,t){e.scenarioName===i.Cu.ActivitySwitch&&e.source===r.p.ActivityFeedBellClick&&l.includes(t)&&(e.scenarioName=i.Cu.NavigationCommand)}},678685:(e,t,n)=>{n.d(t,{q:()=>a});const a=(e,t)=>{if(e&&t){const t=/^(.*); expires=(.*); path=\/(; (.*))?$/,n=2,a=e.match(t);if(a){return new Date(a[n]).getTime()>Date.now()}}return!1}},225673:(e,t,n)=>{n.d(t,{W:()=>o});var a=n(262775);const i=new RegExp(a.vg.oneDriveFile),r=new RegExp(a.vg.sharePointFile),o=(e,t)=>{if(t){const n=t.replace(a.vg.leadingAndTrailingSlashesRegex,"").split("/");n.pop();const i=n.join("/");return`${new URL(e).origin}/${i}/`}if(r.test(e)){const t=e.match(r);return t?t[0]:null}if(i.test(e)){const t=e.match(i);return t?t[0]:null}if(e){const t=e.split("/"),n=2;if(t.length>=n)return`${t[0]}//${t[n]}/`}return e}},985150:(e,t,n)=>{var a;n.d(t,{b:()=>a}),function(e){e.logErrorMessage="logErrorMessage",e.internalErrorCode="internalErrorCode",e.spoInnerErrorCode="spoInnerErrorCode",e.correlationId="correlationId",e.httpCode="httpCode",e.errorCode="errorCode",e.isExpected="isExpected",e.isRedirect="isRedirect",e.redirectUrl="redirectUrl",e.reason="reason",e.serverResponse="serverResponse"}(a||(a={}))},486164:(e,t,n)=>{n.d(t,{m:()=>i});var a=n(262775);const i=e=>{switch(e){case a.jL.unauthorizedAccess:return!1;case a.jL.clientError:case a.jL.badRequest:case a.jL.internalServerError:case a.jL.serviceUnavailable:case a.jL.tooManyRequests:return!0;default:return!1}}},167636:(e,t,n)=>{n.d(t,{q6:()=>c,O3:()=>d,ei:()=>p,tn:()=>I,qE:()=>y,lW:()=>w});var a=n(870402),i=n(440320),r=n(332752),o=n(139150),s=n(312836);const l="growth_growthplatform_esp_common_component",c=()=>{const{entityCommanding:e}=(0,a.ur)(),t=(0,o.m)();return n=>((0,s.ZN)(t,n),e.esp.launchDialog(n))};function d(e,t,n,a){return e&&t?`${n(a,e,void 0,!0)} ${n(a,t,void 0,!0)}`:n(a,e||t,void 0,!0)}function p(e,t,n,a){const i=w(t,a).reduce(((e,t)=>(e[t.id]=t,e)),{})[e];if(i)if(i?.id||(i.id=e),"Coachmark"!==i.surface||function(e,t){if(e.__typename&&"EspCoachmarkParams"!==e.__typename)return!1;const n=e,a=(e,n)=>h(e,n,t),{targetId:i,content:r,header:o,position:s,align:l,pointing:c,sticky:d,closeButton:p,primaryButton:g,secondaryButton:m,selector:I}=n;return(f(i)||f(I)||a(void 0,"target"))&&a(r,"content")&&(!o||"localized"===o.type&&a(o.localizedContent,"header.localizedContent")||a(o.key,"header.key")&&a(o.namespace,"header.namespace"))&&a(s,"position")&&a(l,"align")&&a(c,"pointing")&&a(d,"sticky")&&a(p,"closeButton")&&u(g,"primaryButton",t)&&u(m,"secondaryButton",t)}(i.params,n))if("Modal"!==i.surface||function(e,t){if(e.__typename&&"EspModalParams"!==e.__typename)return!1;const n=e,a=(e,n)=>h(e,n,t),{userInterfaceControls:i}=n;return a(i,"userInterfaceControls")&&function(e,t){const n=e&&e.map((e=>{switch(e.type){case"image":return m(e,t);case"video":return function(e,t){return e&&h(e.title,"title",t)&&h(e.src,"src",t)}(e,t);case"button":return function(e,t){return e&&h(e.isPrimary,"isPrimary",t)&&h(e.action,"action",t)}(e,t);case"text":return g(e,t);case"space":return function(e,t){return e&&h(e.height,"height",t)}(e,t);case"infoItem":return function(e,t){return m(e.image,t)&&g(e.title,t)&&g(e.description,t)}(e,t);case"themePicker":case"simpleCollabViewPicker":return!0;case"accountPicker":return function(e,t){return e&&h(e.filterAccountType,"filterAccountType",t)}(e,t);case"freePremiumExperience":return function(e,t){return e&&h(e.options,"options",t)}(e,t);default:return!1}}));return!(!n||n.indexOf(!1)>-1)}(i,t)}(i.params,n)){if("QuickGuide"!==i.surface||function(e,t,n){if(e.__typename&&"EspQuickGuideParams"!==e.__typename)return!1;const a=e,i=a.cards,r=(e,t)=>h(e,t,n),{cards:o}=a;if(!r(o,"cards"))return!1;if(0===o.length)return n.errorToTelemetry?.(`Cards for surface: ${t} are not defined.`,l,void 0,!0),!1;return i.every((({targetId:e,selector:t,content:n,header:a,position:i,align:o,pointing:s})=>(f(e)||f(t)||r(void 0,"target"))&&r(n,"content")&&(!a||"localized"===a.type&&r(a.localizedContent,"header.localizedContent")||r(a.key,"header.key")&&r(a.namespace,"header.namespace"))&&r(i,"position")&&r(o,"align")&&r(s,"pointing")))}(i.params,e,n))return i;n.errorToTelemetry?.(`QuickGuide surface: ${e} is incorrectly defined.`,l,void 0,!0)}else n.errorToTelemetry?.(`Dialog surface: ${e} is incorrectly defined.`,l,void 0,!0);else n.errorToTelemetry?.(`Coachmark surface: ${e} is incorrectly defined.`,l,void 0,!0);else n.errorToTelemetry?.(`Cannot find surface: ${e} in ESP configuration.`,l,void 0,!0)}function u(e,t,n){return!e||h(e.content,`${t}.content`,n)&&h(e.action,`${t}.action`,n)}function g(e,t){return e&&h(e.resource,"resource",t)}function m(e,t){return e&&h(e.alt,"alt",t)&&h(e.src,"src",t)}function h(e,t,n){return void 0===e&&n.errorToTelemetry?.(`Required property ${t} is not defined.`,l,void 0,!0),void 0!==e}function f(e){return void 0!==e}function I(e){return"Coachmark"===e||"QuickGuide"===e}const y=e=>{switch(e){case"Modal":return i.rP.dialog;case"Coachmark":default:return i.rP.popover;case"QuickGuide":return i.rP.quickGuide;case"SyntheticNotification":case"TfwNotification":return i.rP.activityFeed}},w=(e,t)=>{const n=v(e);return t&&t.length?n.concat(t):n},v=e=>{const t=e.get(r.w.Esp),{testAutomation:n}=e.get(r.w.Test),a=[];return Object.keys(t).forEach((e=>{const i=t[e];i&&i.surface&&!!n==!!i.isTest&&a.push(S(i,e))})),a},S=(e,t)=>({...e,id:t,priority:e.priority,trigger:e.trigger,surface:e.surface,recur:Math.max(-1,e.recur||1),isControlGroup:!!e.isControlGroup,triggerFilter:e.triggerFilter,targetWindow:e.targetWindow,condition:e.condition,fetchDataKeys:e.fetchDataKeys||[],dataCondition:e.dataCondition,expiryDate:e.expiryDate,viewExternalTelemetry:e.viewExternalTelemetry,closeExternalTelemetry:e.closeExternalTelemetry,dataIdentifier:e.dataIdentifier,categories:e.categories,delayInSeconds:Math.max(Number.isInteger(e.delayInSeconds)?e.delayInSeconds:0,0),ignoreLock:!!e.ignoreLock,params:e.params})},832762:(e,t,n)=>{n.d(t,{q:()=>i});var a=n(362328);const i={kind:"Document",get definitions(){const e=(0,a.G)("query ComponentsFileActionsChannelQuery($conversationId:ID!) {channelByID(conversationId:$conversationId) {channelType,displayName,description,defaultFileSettings {filesRelativePath},id,owningTeam {id,displayName,teamSiteInformation {groupId},isArchived,teamType,tenantId},memberRole}}");return delete this.definitions,this.definitions=e.definitions}}},847046:(e,t,n)=>{n.d(t,{x:()=>r});var a=n(362328);const i={kind:"Document",get definitions(){const e=(0,a.G)("query ComponentsStageViewUtilsAppDefinitionQuery($appId:ID!,$scope:AppInstallScope,$conversationId:String,$options:AppsFilterOptionsInput) {appDefinition(appId:$appId,scope:$scope,conversationId:$conversationId,options:$options) {id,bots {id,scopes},connectors {scopes},messageExtensions {scopes,commands {id,context}},meetingExtensionDefinition {scenes {id},filters {id}},galleryTabs {scopes},staticTabs {scopes},tenantId,isMicrosoftOwned,isFullScreenApp,isBlocked}}");return delete this.definitions,this.definitions=e.definitions}},r=async(e,t,n,a,r,o)=>{let s;n&&(s=a||"GroupChat");const{data:l,error:c}=await e.query({query:i,variables:{appId:t,scope:s,conversationId:n,options:{allowBlockedApps:o}},context:{callerInfo:`${r}-getAppDefinition`}});if(l&&l.appDefinition&&!c)return l.appDefinition}},21211:(e,t,n)=>{n.d(t,{H:()=>o});var a=n(802756),i=n(26907),r=n(847046);const o=async(e,t,n,o,s)=>{try{const{appId:l}=e,c=await(0,r.x)(t,l,e.convId,e.appInstallScope,"launch-mw-stage-view-without-chat");e.isFullScreenApp=!!c&&(0,i.QP)(c),o?.appendEventData({"App.isFullScreenApp":e.isFullScreenApp,"StageView.OpenMode":"popout","StageView.CorrelationId":e.correlationId}),o?.mark(a.BQ.StageViewAppDefFetchedBeforeLaunch);const d=(0,i.Gi)(e,e.contentUrl);return d?(o?.mark(a.BQ.LaunchingCollabStageWithoutChatEntityCommand),n.platform.launchStageMWWithoutChat({id:d,stageOptions:e,commandSource:s})):Promise.reject("Entity commanding not available")}catch(e){throw o?.mark(a.BQ.StageViewFailedBeforeCommandTrigger),e}}},343265:(e,t,n)=>{n.d(t,{p:()=>r});var a=n(802756),i=n(26907);const r=async(e,t,n,r)=>{n?.appendEventData({"StageView.OpenMode":"popoutWithChat","StageView.CorrelationId":e.correlationId});const{stageViewId:o,linkedEntity:s}=(0,i.iE)(e);return o&&s?(n?.mark(a.BQ.LaunchingCollabStageWithChatEntityCommand),t.platform.launchStageMW({id:o,linkedEntity:s,stageOptions:e,commandSource:r})):Promise.reject("Entity commanding not available")}},51771:(e,t,n)=>{n.d(t,{N:()=>V});var a=n(915825),i=n(49960),r=n(440320),o=n(332752),s=n(277362),l=n(942016),c=n(727780),d=n(802756),p=n(947521),u=n(26907),g=n(232122),m=n(767867),h=n(790491);var f=n(362328);const I={kind:"Document",get definitions(){const e=(0,f.G)("fragment ComponentsStageViewUtilsAppDefinitionFragment on AppDefinition {id,name,developerName,developerUrl,privacyUrl,termsOfUseUrl,version,shortDescription,longDescription,smallImageUrl,largeImageUrl,accentColor,categories,validDomains,externalId,tenantId,isBlocked,isFullScreenApp,isFullTrustApp,isMicrosoftOwned,showTabLoadingIndicator,videoUrl,devicePermissions,defaultInstallScope,manifestVersion,disabledScopes,galleryTabs {configurationUrl,canUpdateConfiguration,canHaveTabConversation,scopes,meetingSurfaces,context},staticTabs {entityId,name,order,contentUrl,contentBotId,websiteUrl,scopes,context,containerAppIds},webApplicationInfo {id,appKey,resource,applicationPermissions}}");return delete this.definitions,this.definitions=e.definitions}},y={kind:"Document",get definitions(){const e=(0,f.G)("fragment ComponentsStageViewUtilsInstalledAppFragment on InstalledApp {id,installationState,installedVersion,installedScope,definition {id,...ComponentsStageViewUtilsAppDefinitionFragment}}");return delete this.definitions,this.definitions=[...e.definitions,...I.definitions]}},w={kind:"Document",get definitions(){const e=(0,f.G)("query ComponentsStageViewUtilsInstalledSideLoadAppQuery($installedScope:AppInstallScope!,$externalId:String!,$conversationId:String) {installedSideLoadApp(installedScope:$installedScope,externalId:$externalId,conversationId:$conversationId) {id,...ComponentsStageViewUtilsInstalledAppFragment}}");return delete this.definitions,this.definitions=[...e.definitions,...y.definitions]}},v={kind:"Document",get definitions(){const e=(0,f.G)("query ComponentsStageViewUtilsInstalledAppByIdQuery($installedScope:AppInstallScope!,$appId:ID!,$conversationId:String) {installedApp(installedScope:$installedScope,appId:$appId,conversationId:$conversationId) {id,installedScope,installationState}}");return delete this.definitions,this.definitions=e.definitions}};var S=n(847046);const C=async(e,t,n,a,i,r)=>{const{appId:o,convId:s,replyChainId:l,channelId:c}=e,p=c||l?void 0:s,u=l?c||s:c,m=u||p||"";let h="Personal";try{h=await b(t,p,u),e.appInstallScope=h,P(d.BQ.StageViewTargetInstallationScopeConfirmed,`confirmed installed scope for chatThreadId: ${p}, channelThreadId: ${u} is ${h}`,i,r),a.log(`confirmed installed scope for chatThreadId: ${p}, channelThreadId: ${u} is ${h}`);const s={conversation:{id:m,scope:h},shouldFetchPersonalApps:!0},l=await(async(e,t,n,a,i)=>{const r=i||{},o=t.newScenario(d.Cu.ExtInstalledAppsV2);try{const t=[];if(o.appendEventData({dataSource:"installedApp query",correlationId:a}),r.shouldFetchPersonalApps){const i=e.query({query:v,variables:{installedScope:"Personal",appId:n},context:{callerInfo:`${a}-getInstalledAppById`}}).then((e=>e.data?.installedApp));t.push(i)}if(r.conversation&&r.conversation.id){const i=e.query({query:v,variables:{installedScope:r.conversation.scope,appId:n,conversationId:r.conversation.id},context:{callerInfo:`${a}-getInstalledAppsById`}}).then((e=>e.data?.installedApp));t.push(i)}const i=(await Promise.all(t)).filter((e=>!!e));return o.mark(d.BQ.ExtAppsProcessed),o.stop({appCount:i.length}),i}catch(e){return o.fail({errors:`failed to get installed app id: ${n}`}),[]}})(t,n,o,`jit-install-for-stage-view-${e.entryPoint}`,s);a.log(`Fetched Installed apps length: ${l.length} `);const c=l.find((e=>(0,g.e6)(e)));if(P(d.BQ.StageViewInstalledAppsFetched,`${l?.length} appEntitlements returned with preInstalledApp as ${!!c}, for ${h} scope and ${m} threadId.`,i,r),c)return i?.mark(d.BQ.StageViewAppIsPreInstalled),r?.mark(d.BQ.StageViewAppIsPreInstalled),{appInstalled:!0,appInstallScope:c.installedScope};{const s=await $(t,a,o,h,m,!l.length,i,r);if(s?.definition)return e.appId=s.definition.id||e.appId,e.appInstallScope=h,i?.appendEventData({"App.isSideLoaded":!!s.definition.externalId}),r?.appendEventData({"App.isSideLoaded":!!s.definition.externalId}),P(d.BQ.StageViewAppIsPreInstalled,`App ${s.definition.externalId} is sideloaded, with internalAppId ${s.definition.id}`,i,r),{appInstalled:!0,appInstallScope:h};P(d.BQ.StageViewAppIsNotPreInstalled,`${l?.length} appEntitlements returned for ${h} scope and ${m} threadId.`,i,r);const{appInstalled:c,appInstallScope:p}=await A(o,m,h,t,n,a,i,r);return e.appInstallScope=p,{appInstalled:c,appInstallScope:p}}}catch(e){return k(a,h,i,r,e?.message,m),{appInstalled:!1,appInstallScope:h}}},b=async(e,t,n)=>{if(n)return"Team";if(t){const n=await(async(e,t,n)=>{const{data:a}=await t.query({query:h.A,variables:{convId:e},context:{callerInfo:n}});return a.chat?.isOneOnOneBotChat??!1})(t,e,"handleJITInstallForStageView");return n?"Personal":"GroupChat"}return"Personal"},A=async(e,t,n,a,i,r,o,s)=>{let l=!1,c=n;const p=await(0,S.x)(a,e,t,n,"jit-install-for-stage-view",!0);if(!p)return T(r,`App ${e} could'nt be fetched from app catalog. App might not exist in the store.`,o,s),{appInstalled:l,appInstallScope:c};if(P(d.BQ.StageViewAppDefFetched,`App.isBlocked: ${p?.isBlocked||!1}`,o,s),p.isBlocked)return T(r,`App ${e} is blocked by tenant, can not show the app content`,o,s),{appInstalled:l,appInstallScope:c};const u=(0,m.Z1)("Personal",p);let g;if(u){c="Personal";const t=`installing in personal scope: isPersonalScopeSupported: ${u}`;P(d.BQ.StageViewInstallingInPersonalScope,t,o,s),g=await(0,m.Pe)(a,i,d.Cu.AppInstallationDialogInstallApp,e,"Personal",r,!0,void 0,{reason:t,"App.Scope":"Personal",correlationId:s?.id},void 0,"jit-install-for-stage-view"),l=!!g}else if("Personal"!==n&&(0,m.Z1)(n,p)){const p=`installing in scope: ${n}, conversationId: ${t}`;P(d.BQ.StageViewInstallingInChatChannelScope,p,o,s);try{g=await(0,m.Pe)(a,i,d.Cu.AppInstallationDialogInstallApp,e,n,r,!0,t,{reason:p,correlationId:s?.id,"App.Scope":n},void 0,"jit-install-for-stage-view")}catch(e){k(r,n,o,s,e?.message,t)}l=!!g,c=n}else T(r,`installScope: ${n} is not supported by app: ${e}`,o,s);return l&&P(d.BQ.StageViewAppInstallationDone,`installed in ${c} scope, conversationId: ${t}`,o,s),{appInstalled:l,appInstallScope:c}},P=(e,t,n,a)=>{n?.mark(e,{reason:t}),a?.mark(e,{reason:t})},T=(e,t,n,a)=>{e.warn(t),n?.incomplete({reason:t}),a?.incomplete({reason:t})},k=(e,t,n,a,i,r)=>{const o=`JIT-Install failed in scope: ${t}, conversationId: ${r} Reason: ${i}`;e.error(o),i?.includes("NoPermissionToInstallApp")?T(e,"User does not have permissions to install app in scope",n,a):(n?.fail({errors:o}),a?.fail({errors:o}))},$=async(e,t,n,a,i,r,o,s)=>{const l={installedScope:a,externalId:n,conversationId:i};try{if(r){const{data:t}=await e.query({query:w,variables:l,fetchPolicy:"cache-first",context:{callerInfo:"jit-install-for-stage-view"}});return P(d.BQ.StageViewSideLoadQueryReturned,`Side load query returned for app ${n}`,o,s),t?.installedSideLoadApp}return null}catch(e){return t.error(`Failed fetching side loading details for app ${n}, threadId: ${i}, scope, ${a}: ${e}`),null}};var E=n(343265);const D=(e,t,n,a,i)=>{const{enableReactStageModal:r}=t.get(o.w.Extensibility);return r?(i?.appendEventData({"StageView.OpenMode":"modal","StageView.CorrelationId":e.correlationId}),i?.mark(d.BQ.LaunchingStageModalEntityCommand),n.platform.launchReactStageModal(e.appId,e,{visibilityState:c.Rp.show,stateTransition:c.Ar.extend,correlation:{source:a,id:e.correlationId}}).toPromise()):n.platform.launchStage({stageOptions:e,entityCommand:{stateTransition:c.Ar.extend,visibilityState:c.Rp.show,correlation:{source:a}}}).toPromise()};var B=n(21211),F=n(75914);const M=e=>{let t=i.bY.personal;switch(e){case"Team":t=i.bY.team;case"GroupChat":t=i.bY.group}return t},V=async(e,t,n,a,s,l,c,d,p)=>{const{enableCommandingTelemetryForCollabStageMW:g,enableReactStageModal:m,enableProgrammaticPopoutStageViewOpenAPI:h,enableProgrammaticPopoutStageDeeplink:f}=t.get(o.w.Extensibility);let I,y,w=e;if(!g){const{phase1CollabStageScenario:e,endToEndScenario:t}=(0,u.d1)(a);I=e,y=t,w.launchScenarioId=t.id,w.phase1OnlyScenarioDetails={scenarioMarkerName:e.name,scenarioMarkerId:e.id}}if(!w.appId)return I?.incomplete({errors:"AppId cannot be empty for launching stage view"}),y?.incomplete({errors:"AppId cannot be empty for launching stage view"}),Promise.reject("AppId cannot be empty for launching stage view");if(l)try{w=await O(s,l,w,n,I,y)}catch(e){return Promise.reject(`Could not determine if threadId passed is chat/channel: ${e}`)}if(w.openMode=(0,u.mg)(t,w),I?.appendEventData({"App.Id":w.appId,"Thread.Id":w.convId,"PlatformApp.ScenarioCapability":i.n3.tabs,"App.EntryPoint":w.entryPoint,"StageView.OpenMode":w.openMode,"StageView.inputThreadIdDefined":!!l,"StageView.CorrelationId":w.correlationId,"PlatformApp.IsMultiWindow":w.openMode!==u.bq.modal}),y?.appendEventData({"App.Id":w.appId,"Thread.Id":w.convId,"App.EntryPoint":w.entryPoint,"StageView.OpenMode":w.openMode,"StageView.inputThreadIdDefined":!!l,"StageView.CorrelationId":w.correlationId,"PlatformApp.IsMultiWindow":w.openMode!==u.bq.modal}),!m&&w.openMode===u.bq.modal&&c)return I?.cancel({errors:"Opening angular modal hence cancelling react scenarios"}),y?.cancel({errors:"Opening angular modal hence cancelling react scenarios"}),x(w,t,n,c,void 0);const{appInstalled:v,appInstallScope:S}=await C(w,n,a,s,I,y);if(d&&d.recordPanelAction(((e,t,n,a,o)=>{const{actionOutcome:s,panelType:l}=(0,u.lT)(n,a),c=o.createDatabag(),d={actionGesture:r.Od.auto,actionOutcome:s,actionScenario:r.vB.openStageView,actionScenarioType:r.DB.stageView,moduleName:r.Sn.stageViewMainContent,moduleType:r.nR.stageview,panelRegion:n===u.bq.modal?r.rP.dialog:r.rP.main,panelType:l,extensibilityData:{id:e,scope:t,scenarioCapability:i.n3.tabs}};return d.dataBag=c,d})(w.appId,M(S),w.openMode,w.entryPoint,d)),p){const e=p.createDatabag(),{actionOutcome:t,panelType:n}=(0,u.lT)(w.openMode,w.entryPoint),a={actionGesture:r.Od.auto,actionOutcome:t,actionScenario:r.vB.openStageView,actionScenarioType:r.DB.stageView,moduleName:r.Sn.stageViewMainContent,moduleType:r.nR.stageview,panelRegion:w.openMode===u.bq.modal?r.rP.dialog:r.rP.main,panelType:n,dataBag:e,extensibilityData:{id:w.appId,scope:M(S),scenarioCapability:i.n3.tabs}};p.recordPanelAction(a,s)}return v?(I?.appendEventData({"App.Scope":S}),y?.appendEventData({"App.Scope":S}),x(w,t,n,c,I,y,!!h,!!f).catch((()=>(y?.fail({errors:"Failed to launch"}),I?.fail({errors:"Failed to launch"}),_())))):(I?.fail({errors:`App could not be installed- ${S}`}),y?.fail({errors:`App could not be installed- ${S}`}),_())},O=async(e,t,n,i,r,o)=>{let s={chat:null};try{s=await(0,a.zB)(i,t)}catch(n){r?.mark(d.BQ.ChatQueryFailed,{reason:`ChatQuery failed for inputThreadId: ${t}`}),o?.mark(d.BQ.ChatQueryFailed,{reason:`ChatQuery failed for inputThreadId: ${t}`}),e.error(`Could not determine if inputThreadId is chat/channel, ChatQuery failed for inputThreadId: ${t}`)}if(s?.chat){const{chatSubType:a,memberIds:i}=s.chat;switch(r?.mark(d.BQ.ChatQuerySuccessful,{reason:`chatSubType: ${a}, memberIds.length: ${i?.length}`}),o?.mark(d.BQ.ChatQuerySuccessful,{reason:`chatSubType: ${a}, memberIds.length: ${i?.length}`}),a){case F.vW.Channel:return e.log(`inputThreadId is a channel ${t}`),{...n,convId:t,channelId:t,replyChainId:void 0,messageId:void 0};case F.vW.Meeting:case F.vW.None:e.log(`inputThreadId is a chat ${t}`);const a={...n,convId:t,channelId:void 0,replyChainId:void 0,messageId:void 0};return i&&0!==i.length||n.openMode===u.bq.modal?a:{...a,openMode:u.bq.popout};default:return e.error("chatSubType is not present in chatQuery return, launching stage view in personal scope context"),{...n,convId:"",channelId:void 0,replyChainId:void 0,messageId:void 0}}}return r?.mark(d.BQ.ChatQueryReturnedEmptyData,{reason:`ChatQuery result is empty for inputThreadId: ${t}`}),o?.mark(d.BQ.ChatQueryReturnedEmptyData,{reason:`ChatQuery result is empty for inputThreadId: ${t}`}),e.error(`Could not determine if inputThreadId is chat/channel, ChatQuery result is empty for inputThreadId: ${t}`),{...n,convId:"",channelId:void 0,replyChainId:void 0,messageId:void 0}},x=async(e,t,n,a,i,r,o,s)=>{try{const l=j(e.entryPoint);switch(e.entryPoint){case p.hB.adaptiveCardCollabStage:return await U(e,l,a,i);case p.hB.fileChiclet:return await L(e,n,l,a,i);case p.hB.deepLinkStageView:return await R(e,i,r,s);case p.hB.stageViewOpenSDKApi:return await Q(e,t,n,l,a,i,o);case p.hB.adaptiveCardStageModal:return await W(e,t,l,a,i);default:return Promise.reject(`Stage view entry point not supported. Entrypoint: ${e.entryPoint}`)}}catch(e){return q(e,i,r),Promise.reject(e)}},U=async(e,t,n,a)=>n?(0,E.p)(e,n,a,t):Promise.reject("Entity commanding not available"),L=async(e,t,n,a,i)=>a?e.openMode===u.bq.popout?(0,B.H)(e,t,a,i,n):(0,E.p)(e,a,i,n):Promise.reject("Entity commanding not available"),R=async(e,t,n,a)=>{if(!e.contentUrl)return t?.incomplete({errors:"ContentUrl cannot be empty for deeplink"}),n?.incomplete({errors:"ContentUrl cannot be empty for deeplink"}),_();if(!a)return z(e,t);switch(e.openMode){case u.bq.modal:return z(e,t);case u.bq.popoutWithChat:return e={...e,showChatTitleForHeader:!0},H(e,t);case u.bq.popout:return N(e,t);default:return z(e,t)}},Q=async(e,t,n,a,i,r,o)=>{if(!o)return i?D({...e,openMode:"modal"},t,i,a,r):Promise.reject("Entity commanding not available");switch(e.openMode){case u.bq.popout:return i?(0,B.H)(e,n,i,r,a):Promise.reject("Entity commanding not available");case u.bq.popoutWithChat:return i?(0,E.p)(e,i,r,a):Promise.reject("Entity commanding not available");case u.bq.modal:default:return i?D(e,t,i,a,r):Promise.reject("Entity commanding not available")}},W=async(e,t,n,a,i)=>a?D(e,t,a,n,i):Promise.reject("Entity commanding not available"),q=(e,t,n)=>{const a=e instanceof Error?e.message:String(e);t?.fail({errors:`Unexpected error occurred-${a}`}),n?.fail({errors:`Unexpected error occurred-${a}`})},j=e=>{switch(e){case p.hB.stageViewOpenSDKApi:return s.p.StageViewOpenSDKApi;case p.hB.deepLinkStageView:return s.p.StageViewDeeplink;case p.hB.fileChiclet:return s.p.FileChicletActions;default:return s.p.AdaptiveCardInvokeButton}},H=async(e,t)=>{const{stageViewId:n,linkedEntity:a}=(0,u.iE)(e);return n&&a?(t?.mark(d.BQ.LaunchingCollabStageWithChatEntityCommand),Promise.resolve({entityCommand:{entity:{id:n,type:l.ck.platformStage,action:l.SY.create,linkedEntity:a},command:{stateTransition:c.Ar.new,visibilityState:c.Rp.show,correlation:{id:e.correlationId,source:s.p.StageViewDeeplink,startTimestamp:e.scenarioStartTime}},entityOptions:e},metadata:{allowAnonymous:!1}})):Promise.reject("Entity commanding not available")},_=async()=>Promise.resolve({entityCommand:{entity:{type:l.ck.unsupportedcollabstageerrordialog,action:l.SY.view},command:{stateTransition:c.Ar.extend,visibilityState:c.Rp.show},entityOptions:{}},metadata:{allowAnonymous:!1}}),N=async(e,t)=>{const n=(0,u.Gi)(e,e.contentUrl);return n?(t?.mark(d.BQ.LaunchingCollabStageWithoutChatEntityCommand),Promise.resolve({entityCommand:{entity:{id:n,type:l.ck.platformstagewithoutchat,action:l.SY.view},command:{stateTransition:c.Ar.new,visibilityState:c.Rp.show,correlation:{id:e.correlationId,source:s.p.StageViewDeeplink,startTimestamp:e.scenarioStartTime}},entityOptions:e},metadata:{allowAnonymous:!1}})):Promise.reject("Entity commanding not available")},z=async(e,t)=>{const n={entityCommand:{entity:{id:e.appId,type:l.ck.platformstagemodal,action:l.SY.view},command:{visibilityState:c.Rp.show,stateTransition:c.Ar.extend,correlation:{id:e.correlationId,source:s.p.StageViewDeeplink}},entityOptions:e},metadata:{allowAnonymous:!1}};return t?.mark(d.BQ.LaunchingStageModalEntityCommand),Promise.resolve(n)}},305870:(e,t,n)=>{n.d(t,{Ze:()=>a,I_:()=>M,h5:()=>O});var a,i=n(513432),r=n(870402),o=n(272786),s=n(332752),l=n(675853),c=n(942016),d=n(728177),p=n(139150),u=n(767867),g=n(648753),m=n(661861),h=n(695116),f=n(514072),I=n(789403),y=n(895543),w=n(414250),v=n(835647),S=n(59552),C=n(192451),b=n(313216),A=n(783650),P=n(238105),T=n(802756),k=n(832762),$=n(262775),E=n(457594),D=n(51771),B=n(947521),F=n(425658);!function(e){e.PlatformApp="PlatformApp",e.OneUp="OneUp",e.OneUpPageEmbed="OneUpPageEmbed"}(a||(a={}));const M=()=>{const{entityCommanding:e,scenarioFactory:t,windowHistoryNavigationService:n,coreSettings:a}=(0,r.ur)(),{entity:c,getEntityOptions:u}=(0,o.At)(),g=(0,p.m)(),{enableAppBasedFileHandlingForWXPTMP:m,enableFilesAppBasedFileHandlingForPDFTMP:h,enableFilesPDFAppIdForViewTMP:f,enableFilesAdminPreinstallCheckForPDFAppTMP:I,enableFilesAAACheckForPDFAppTMP:y,allowedInstallerAzureADAppIdsForPDFApp:w,enableAppBasedFileHandlingForOneNoteTMP:v,enableAppBasedFileHandlingForVisioTMP:S}=(0,d.w2)(s.w.Files,["enableAppBasedFileHandlingForWXPTMP","enableFilesAppBasedFileHandlingForPDFTMP","enableFilesPDFAppIdForViewTMP","enableFilesAdminPreinstallCheckForPDFAppTMP","enableFilesAAACheckForPDFAppTMP","allowedInstallerAzureADAppIdsForPDFApp","enableAppBasedFileHandlingForOneNoteTMP","enableAppBasedFileHandlingForVisioTMP"]),{enableCollabStageForWXP:C}=(0,d.w2)(s.w.Extensibility,["enableCollabStageForWXP"]),{enableAppsQueryOptimization:b,enablePopOutFileChicletInMultiWindow:A,enableInstalledAppQueryOptimization:P}=(0,d.w2)(s.w.Extensibility,["enableAppsQueryOptimization","enablePopOutFileChicletInMultiWindow","enableInstalledAppQueryOptimization"]),{isPrimaryWindow:T}=(0,d.w2)(s.w.Core,["isPrimaryWindow"]),k=(0,l.U)("InTeamsFileViewerResolver"),$=i.useRef(new Map),{sdkHostType:E}=(0,d.w2)(s.w.Sdk,["sdkHostType"]);return i.useCallback((async(i,r,o,s)=>{V(Q(i,!!A,!!T),r,o,s,e,a,c,n,u,g,!!m,!!h,!!y,f,w,!!I,!!v,!!S,!!b,!!P,!!C,E,k,t,$)}),[A,T,e,a,c,n,u,g,m,h,y,f,w,I,v,S,b,P,C,E,k,t])},V=async(e,t,n,a,i,r,o,s,l,d,p,u,m,h,f,I,y,w,v,S,C,b,A,P,k)=>{const M=P.newScenario(T.Cu.FileViewerResolver);try{const V=(0,g.sI)(e.fileType),x=await R(e,d,A),U=k.current;e={...e,tenantId:x?.channelByID.owningTeam?.tenantId||void 0};const L=await O(d,e.fileType,p,u,m,h,f,I,y,w,v,S,A,P);if(e.subEntityId){const t=l(c.ck.extensions,c.SY.view);s.pushToWindowHistory(o,{...t,subEntityId:e.subEntityId})}if(L){if(M.mark(T.BQ.FileViewerResolverRoutingToInstalledApp),a(t,{...n,dataBagProperties:{...n.dataBagProperties,fileViewerType:"PlatformApp",fileViewerAppId:L,fileAction:$.BK.editInTeams},actionKey:"edit_in_teams"}),U.get(e.fileId)!==e.threadId&&(0,E.RL)(P,L,"personalApp",A,e.shouldOpenInMultiWindow,!0),U.set(e.fileId,e?.threadId),e.threadId&&C&&"Desktop"===b){const n={convId:e.threadId,messageId:e.messageId,appId:L,entryPoint:B.hB.fileChiclet,contentUrl:e.shareUrl||e.objectUrl,websiteUrl:e.shareUrl||e.objectUrl,entityId:e.fileId,subEntityId:JSON.stringify({...e,hideClose:!0,fileTitle:t.title}),correlationId:(0,F.A)(),scenarioStartTime:(new Date).getTime()};return e.replyChainId&&(n.replyChainId=e.replyChainId),(0,D.N)(n,r,d,P,A,void 0,i).then((()=>M.stop())).catch((e=>{const t=`Unexpected error while launching stage: ${e?.errorCode}`;A.errorToTelemetry?.(t,"files_viewer_resolver"),M.mark("StageViewLaunchFailed")}))}return i.file.launchFileViewApp(L,{...e,baseUrl:e.siteUrl}),void M.stop()}V===g.j_.OneUpViewer?(M.mark(T.BQ.FileViewerResolverRoutingToOneupViewer),a(t,{...n,dataBagProperties:{...n.dataBagProperties,fileViewerType:"OneUp",fileAction:$.BK.openInTeams},actionKey:"edit_in_teams"}),i.file.openInOneup(e)):(A.errorToTelemetry?.("This means no platform app installed for a office file type. Not good","files_viewer_resolver"),M.mark(T.BQ.FileViewerResolverFallback),a(t,{...n,actionKey:"edit_in_teams"}),i.file.fileById(e)),M.stop()}catch(e){const t=`Unexpected error while file viewer resolution with error code: ${e?.errorCode}`;A.errorToTelemetry?.(t,"files_viewer_resolver"),M.fail({errorCode:e?.errorCode,message:t,reason:"Unexpected error while file viewer resolution"})}},O=async(e,t,n,a,i,r,o,s,l,c,d,p,g,m)=>{const h=await x(e,t,n,a,i,r,o,s,l,c,d,p,g,m);if(h){const t=await(0,u.tN)(e,g,m,h,d,"file-viewer-route-to-platform-app",{shouldFetchPersonalApps:!0,enableInstalledAppQueryOptimization:p});if(t&&t.length>0&&(g.logNoPii?.(`getDocumentViewAppId: Pre-install check enabled: app pre-install state ${t[0].installationState}`),L(t[0])))return h}},x=async(e,t,n,a,i,r,o,s,l,c,d,p,u,T)=>{const{icon:k}=(0,g.ao)(t);switch(k){case m.f:case h.K:if(n)return"3e0a4fec-499b-4138-8e7c-71a9d88a62ed";break;case f.E:case I.j:if(n)return"d7958adf-f419-46fa-941b-1b946497ef84";break;case y.V:case w.g:if(n)return"1c256a65-83a6-4b5c-9ccf-78f8afb6f1e8";break;case v.P:if(a)return U(r,s,i,o,e,d,p,u,T);break;case S.y:case C.T:case b.v:if(l)return"0d820ecd-def2-4297-adad-78056cde7c78";break;case A.a:case P.r:if(c)return"d7958adf-f419-46fa-941b-1b946497ef95"}},U=async(e,t,n,a,i,r,o,s,l)=>{const c=e;if(c){const e=await(0,u.tN)(i,s,l,c,r,"check-status-and-give-pdf-app-for-user",{shouldFetchPersonalApps:!0,enableInstalledAppQueryOptimization:o});if(n){if(!(e&&e.length>0))return;{const t=e[0].installerIdentity?.azureAdAppId,n=t&&a?.includes(t);if(s.logNoPii?.(`getDocumentViewAppId: AAA Pre-install check enabled: Is App Installed by AAA:  ${n} and installedByAppId: ${t}}`),n)return c}}return t?e&&e.length>0?(s.logNoPii?.(`getDocumentViewAppId: Pre-install check enabled: app pre-install state ${e[0].installationState}`),"AdminPreInstalled"===e[0].installationState?c:void 0):void 0:c}},L=e=>!!e.installationState&&["Installed","InstalledAndFavorited","InstalledAndPermanent","AdminPreInstalled"].includes(e.installationState),R=async(e,t,n)=>{try{if(e.threadId){const{data:a,error:i}=await t.query({query:k.q,fetchPolicy:"cache-first",variables:{conversationId:e.threadId}});return i?void n.errorToTelemetry?.(`getChannelFields threw error ${i.message}`,"files_viewer_resolver"):a}return}catch(e){return void(e?.message?.includes("Id is not of a channel")?n.logNoPii?.(`Not called from channel ${e.message}`):n.errorToTelemetry?.(`Exception while fetching channel info ${e?.message}`,"files_viewer_resolver"))}},Q=(e,t,n)=>t&&!n?{...e,shouldOpenInMultiWindow:!0}:e},26907:(e,t,n)=>{n.d(t,{bq:()=>a,Lx:()=>g,$o:()=>m,A_:()=>h,d1:()=>f,Gi:()=>I,pE:()=>y,iE:()=>w,mg:()=>v,lT:()=>C,QP:()=>A});var a,i=n(332752),r=n(942016),o=n(440320),s=n(915825),l=n(457594),c=n(466563),d=n(802756),p=n(947521),u=n(364819);!function(e){e.modal="modal",e.popout="popout",e.popoutWithChat="popoutWithChat"}(a||(a={}));const g=(e,t)=>e.entryPoint===p.hB.fileChiclet&&t?t:e.contentUrl,m=(e,t)=>t?`${e};replyChainId=${t}`:e,h=(e,t,n)=>{const{licenseType:a}=e.get(i.w.UserResources),{enableStageviewMW:r,enableStageviewMWInChannels:o,enableCollabStageForEDU:l}=e.get(i.w.Extensibility),c=t===p.hQ.desktop;return!(!l&&(0,s.Cd)(a)||!c)&&(!(!r&&!o)&&("chats"===n.type||"channels"===n.type||"callingchats"===n.type))},f=e=>{const t=d.Cu.PlatformTabStageViewFrameLoading,n=e.newScenario(t),a=e.newScenario(d.Cu.PlatformTabLaunch);return n.clientId=n.id,a.clientId=a.id,e.hoistScenarioToCore?.(n),e.hoistScenarioToCore?.(a),{phase1CollabStageScenario:n,endToEndScenario:a}},I=(e,t)=>`${e.appId}-${e.convId}-${t}-${e.reloadToggle}`;function y(e,t,n){const a={};try{if(n?.linkedEntity?.type===r.ck.calls){const{convId:t,messageId:i}=(0,c.q0)(n,r.ck.extensions,r.SY.view,e);i&&"0"!==i?(a.channelId=t,a.parentMessageId=i,a.channelMeetingMessageId=i,a.chatId=t):a.chatId=t}else if(n?.linkedEntity?.type===r.ck.channels){const{channelId:t}=n?.linkedEntity?.id&&JSON.parse(n?.linkedEntity?.id);a.channelId=t;const{messageId:i,replyChainId:o}=(0,c.q0)(n,r.ck.extensions,r.SY.view,e);a.replyChainId=o,a.parentMessageId=i,a.channelMeetingMessageId=i}else switch(n?.type){case r.ck.channels:const{channelId:i}=n?.id&&JSON.parse(n.id);a.channelId=i;break;case r.ck.chats:const o=(n.id??"").split(";replyChainId=");o.length>1&&(a.replyChainId=o[1],a.channelId=o[0]),a.chatId=o[0];break;case r.ck.extensions:const s=(0,l.Wo)(n,t,e);a.parentMessageId=s?.messageId,a.channelMeetingMessageId=s?.messageId,a.chatId=s?.messageId?void 0:s?.threadId,a.channelId=s?.messageId?s?.threadId:void 0}}catch(t){e.log("Error while parsing source view entity.",t?.message)}return a}const w=e=>{const{convId:t}=e;return{stageViewId:I(e,e.contentUrl),linkedEntity:{id:m(t,e.replyChainId),type:r.ck.chats}}},v=(e,t)=>{const{sdkHostType:n}=e.get(i.w.Sdk),r="Desktop"===n,{enableProgrammaticPopoutStageViewOpenAPI:o,enableProgrammaticPopoutStageDeeplink:s}=e.get(i.w.Extensibility);return t.entryPoint===p.hB.adaptiveCardCollabStage?a.popoutWithChat:t.entryPoint===p.hB.deepLinkStageView?S(t,r,!!s):S(t,r,!!o)},S=(e,t,n)=>{if(!t||!n)return a.modal;const i=e.openMode||a.popoutWithChat;return i===a.popoutWithChat?e.convId||e.channelId?e.channelId&&!e.replyChainId?a.popout:a.popoutWithChat:a.popout:i},C=(e,t)=>{switch(t){case p.hB.adaptiveCardCollabStage:return{actionOutcome:b(e),panelType:o.HP.AdaptiveCardCollabStage};case p.hB.stageViewOpenSDKApi:return{actionOutcome:b(e),panelType:o.HP.StageViewOpenSDKAPI};case p.hB.adaptiveCardStageModal:return{actionOutcome:b(e),panelType:o.HP.CollabStageViewModal};case p.hB.deepLinkStageView:return{actionOutcome:b(e),panelType:o.HP.DeeplinkStageView};default:return{actionOutcome:b(e),panelType:o.HP.AdaptiveCardCollabStage}}},b=e=>{switch(e){case a.modal:return o.nd.modal;case a.popout:return o.nd.popout;default:return o.nd.popoutWithChat}},A=e=>{const t=!(0,u.isEmpty)(e.tenantId),n=e.isMicrosoftOwned??!1;return(e.isFullScreenApp??!1)&&(t||n)}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/562569-ff569d9708e4dff8.js.map